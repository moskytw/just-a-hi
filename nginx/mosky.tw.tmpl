server {
    server_name mosky.tw www.mosky.tw;
    root $PUBLIC;

    #rewrite_log on; # When enabled, outputs information about rewrites to the error log at notice level.
    #error_log $ROOT/$LOG/mosky.tw-nginx-error.log notice;
    error_log $ROOT/$LOG/mosky.tw-nginx-error.log;

    access_log $ROOT/$LOG/mosky.tw-nginx-access.log;

    charset UTF-8;

    if ($uri ~ ^/([^/]+)\.(png|jpg|gif|ico|js|css|html|json)$) {
        rewrite \.(png|jpg|gif|ico)$ /img$uri break;
        rewrite \.(js|css|html|json)$ /$1$uri break;
    }

    location ~ ^/(img|js|css|html|json)/ {
        try_files $uri /404.html;
    }

    # pass to uwsgi in any other case
    location / {
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:$PORT;
    }
}
